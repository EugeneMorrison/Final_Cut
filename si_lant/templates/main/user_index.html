{% extends "base.html" %}
{% load custom_tags %}
{% block content %}
<div class="row">
    <div class="col-12 my-4">
        <div class="Equipmentd-new p-3">
			<!-- –ú–µ–Ω—é -->
			<div class="d-flex justify-content-around mb-3">
				<a href="{% url 'equipment_list' %}"  
				   class="pt-0 h3 text-uppercase nav-link {% if request.path|slice:":12" == '/Equipments' %}font-weight-bold text-info{% else %}text-dark{% endif %}">
				   –º–∞—à–∏–Ω—ã
				</a>
				<a href="{% url 'Service-list' %}" 
				   class="pt-0 h3 text-uppercase nav-link {% if request.path|slice:":8" == '/Service' %}font-weight-bold text-info{% else %}text-dark{% endif %}">
				   —Ç–æ
				</a>
				<a href="{% url 'Claim-list' %}" 
				   class="pt-0 h3 text-uppercase nav-link {% if request.path|slice:":7" == '/Claims' %}font-weight-bold text-info{% else %}text-dark{% endif %}">
				   —Ä–µ–∫–ª–∞–º–∞—Ü–∏–∏
				</a>
			</div>

            <h4 class="text-center my-3">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞—Ö —Ç–µ—Ö–Ω–∏–∫–∏</h4>

            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div class="d-flex flex-wrap justify-content-between align-items-end mb-3">
                <!-- –§–∏–ª—å—Ç—Ä—ã –æ—Å—Ç–∞—é—Ç—Å—è —Ç–µ –∂–µ -->
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π —Ç–æ–ª—å–∫–æ —Å–≤–µ—Ä—Ö—É -->
            {% if Equipments %}
            <div class="scroll-container">
                <!-- –í–µ—Ä—Ö–Ω—è—è –ø–æ–ª–æ—Å–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ -->
                <div class="scrollbar scrollbar-top">
                    <div class="scroll-content"></div>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ -->
                <div class="table-wrapper">
                    <table class="table table-hover table-bordered text-sm">
                        <thead class="thead-light text-center">
                            <tr>
                                <th>–ó–∞–≤. ‚Ññ</th>
                                <th>–ú–æ–¥–µ–ª—å —Ç–µ—Ö–Ω–∏–∫–∏</th>
                                <th>–î–≤–∏–≥–∞—Ç–µ–ª—å</th>
                                <th>‚Ññ –¥–≤–∏–≥–∞—Ç–µ–ª—è</th>
                                <th>–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è</th>
                                <th>‚Ññ —Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–∏</th>
                                <th>–í–µ–¥—É—â–∏–π –º–æ—Å—Ç</th>
                                <th>‚Ññ –≤–µ–¥—É—â–µ–≥–æ –º–æ—Å—Ç–∞</th>
                                <th>–£–ø—Ä–∞–≤–ª—è–µ–º—ã–π –º–æ—Å—Ç</th>
                                <th>‚Ññ —É–ø—Ä–∞–≤–ª—è–µ–º–æ–≥–æ –º–æ—Å—Ç–∞</th>
                                <th>–î–æ–≥–æ–≤–æ—Ä</th>
                                <th>–û—Ç–≥—Ä—É–∑–∫–∞</th>
                                <th>–ì—Ä—É–∑–æ–ø–æ–ª—É—á–∞—Ç–µ–ª—å</th>
                                <th>–ê–¥—Ä–µ—Å –ø–æ—Å—Ç–∞–≤–∫–∏</th>
                                <th style="width: 250px;">–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è</th>
                                <th>–ö–ª–∏–µ–Ω—Ç</th>
                                <th>–°–µ—Ä–≤–∏—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for Equipment in Equipments %}
                            <tr>
                                <td>{{ Equipment.vin }}</td>
                                <td>{{ Equipment.vehicle_model.name }}</td>
                                <td>{{ Equipment.engine_model.name }}</td>
                                <td>{{ Equipment.engine_number }}</td>
                                <td>{{ Equipment.transmission_model.name }}</td>
                                <td>{{ Equipment.transmission_number }}</td>
                                <td>{{ Equipment.drive_axle.name }}</td>
                                <td>{{ Equipment.drive_axle_number }}</td>
                                <td>{{ Equipment.steering_axle.name }}</td>
                                <td>{{ Equipment.steering_axle_number }}</td>
                                <td>{{ Equipment.supply_agreement }}</td>
                                <td>{{ Equipment.shipment_date|date:"d.m.Y" }}</td>
                                <td>{{ Equipment.consignee }}</td>
                                <td>{{ Equipment.delivery_address }}</td>
                                <td style="max-width: 250px; white-space: normal; overflow: hidden; text-overflow: ellipsis;" 
                                    title="{{ Equipment.equipment }}">
                                    {{ Equipment.equipment }}
                                </td>
                                <td>{{ Equipment.user }}</td>
                                <td>{{ Equipment.service_company }}</td>
                                <td class="text-center">
                                    {% if request.user|has_group:"manager" or request.user|has_group:"admin" %}
                                        <a class="btn btn-sm btn-outline-primary" href="{% url 'equipment_update' Equipment.pk %}">‚úèÔ∏è</a>
                                        <a class="btn btn-sm btn-outline-danger" href="{% url 'equipment_delete' Equipment.pk %}">üóëÔ∏è</a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% else %}
            <h4 class="mt-4 text-info text-center">–î–∞–Ω–Ω—ã—Ö –æ –º–∞—à–∏–Ω–µ —Å —Ç–∞–∫–∏–º –∑–∞–≤–æ–¥—Å–∫–∏–º –Ω–æ–º–µ—Ä–æ–º –Ω–µ—Ç</h4>
            {% endif %}

            {% if request.user|has_group:"manager" or request.user|has_group:"admin" %}
            <div class="text-center mt-3">
                <a class="btn btn-primary" href="/Equipments/new">–î–æ–±–∞–≤–∏—Ç—å –º–∞—à–∏–Ω—É</a>
                <a class="btn btn-primary" href="/lookups">–†–µ–¥–∞–∫—Ç–æ—Ä —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤</a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    const tableWrapper = document.querySelector('.table-wrapper');
    const scrollbarTop = document.querySelector('.scrollbar-top');
    const scrollContentTop = scrollbarTop.querySelector('.scroll-content');

    function syncScroll(source) {
        tableWrapper.scrollLeft = source.scrollLeft;
    }

    function syncScrollFromTable() {
        scrollbarTop.scrollLeft = tableWrapper.scrollLeft;
    }

    function initScrollbars() {
        const tableWidth = tableWrapper.scrollWidth;
        scrollContentTop.style.width = tableWidth + "px";

        scrollbarTop.addEventListener('scroll', () => syncScroll(scrollbarTop));
        tableWrapper.addEventListener('scroll', syncScrollFromTable);
    }

    document.addEventListener('DOMContentLoaded', initScrollbars);
</script>

<style>
.scroll-container {
    display: flex;
    flex-direction: column;
}
.scrollbar {
    height: 12px;
    overflow-x: auto;
    background: #f8f9fa;
}
.scrollbar .scroll-content {
    height: 1px;
}
.table-wrapper {
    overflow-x: auto;
}
</style>
{% endblock %}
